<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Solicitud de D√≠as de Fiesta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="https://unpkg.com/flatpickr@4.6.13/dist/flatpickr.min.css" />
  <script src="https://unpkg.com/flatpickr@4.6.13/dist/flatpickr.min.js"></script>
  <script src="https://unpkg.com/flatpickr@4.6.13/dist/l10n/es.js"></script>

  <!-- styles omitidos por brevedad -->
</head>
<body>
  <div class="header">
    <img src="avanza_logo.png" alt="Logo Avanza" />
    <span>Portal de solicitudes ‚Äì Taller Avanza Zaragoza</span>
  </div>

  <div class="page-content">
    <div class="form-container">
      <h2>Solicitud Fiestas Pagadas</h2>
      <form id="formFiestas">
        <label for="NumeroJDE">N√∫mero JDE:</label>
        <input type="text" id="NumeroJDE" name="FakeNameEmpleado" autocomplete="off" required />
        <div id="nombreEmpleado" style="margin-top: 0.5rem; padding: 0.6rem; background-color: #eee; border-radius: 6px;"></div>

        <label for="Email">Correo electr√≥nico:</label>
        <input type="email" id="Email" required />

        <label for="Fechas">Fechas solicitadas:</label>
        <input type="text" id="Fechas" placeholder="Selecciona m√∫ltiples fechas..." name="FakeNameFechas" autocomplete="chrome-off" required />

        <input type="hidden" id="FechasSolicitadas" name="FechasSolicitadas" />

        <label for="Comentario">Comentario:</label>
        <textarea id="Comentario" name="comentarioExtra" rows="4" placeholder="Opcional..."></textarea>

        <button type="submit">Enviar solicitud</button>
        <p id="respuesta"></p>
      </form>
    </div>
  </div>

  <footer>
    <div style="max-width: 600px; margin: 0 auto;">
      <p style="margin: 0.2rem 0; color: #DA291C; font-weight: bold;">Mantenimiento Taller de Zaragoza</p>
      <p style="margin: 0.2rem 0;">Direcci√≥n Urbanos Zaragoza ¬∑ Miguel Servet, 199 - 50013 Zaragoza</p>
      <p style="margin: 0.2rem 0;">üìû 976 413 900 ¬∑ ‚úâÔ∏è mantenimiento.zaragoza@mobilityado.com</p>
      <p style="margin: 0.2rem 0;">
        üåê <a href="https://zaragoza.avanzagrupo.com" target="_blank">zaragoza.avanzagrupo.com</a>
      </p>
    </div>
  </footer>

  <script src="https://unpkg.com/flatpickr@4.6.13/dist/flatpickr.min.js"></script>
  <script src="https://unpkg.com/flatpickr@4.6.13/dist/l10n/es.js"></script>

<script>
const empleados = {'105451': 'NICANOR VALVERDE MARTIN', '105524': 'JOSE ANTONIO BUJALANCE CASTRO', '105662': 'CARLOS MANUEL HERRERO GARCIA', '105484': 'FRANCISCO JESUS HIJAZO LARROSA', '105784': 'JOSE MANUEL REMUI√ëAN ANTELO', '105560': 'CARLOS ESPALLARGAS VALERO', '105557': 'ALFONSO MIGUEL ESPES CEREZO', '105705': 'VICTOR JAVIER BEAMONTE PEREZ', '105483': 'FRANCISCO JAVIER SISAMON ZABAL', '105552': 'ANGEL JAVIER GUTIERREZ MARIN', '105502': 'JOSE MARIA JOSA MOR', '105461': 'JUAN CARLOS FERNANDEZ GONZALEZ', '105553': 'RAFAEL ROC RODA', '105554': 'JOSE CARLOS RAMOS MARQUEZ', '105531': 'JOSE FRANCISCO POLA FELIPE', '105520': 'VICTOR MANUEL DURO GIL', '105523': 'JOSE FERNANDO PEIRO MARTINEZ', '105493': 'ANGEL ALCONCHEL JULIAN', '105521': 'JOSE CARLOS MARTINEZ LANCIS', '105532': 'PEDRO GONZALEZ AGREDA', '105522': 'FRANCISCO JOSE MANSO CAZO', '105526': 'JOSE PEDRO LOPEZ MIGUEL', '106018': 'FRANCISCO JAVIER SANCHO LAHOZ', '105737': 'JACK DOUGLAS MCCURLEY', '105555': 'ESTEBAN ALVAREZ ZAMORA', '105525': 'JUAN CARLOS GOMEZ LAHOZ', '105704': 'ALFONSO BURRIEL CRESPO', '105486': 'PEDRO BARRANCO ORCE', '105530': 'JOSE ANTONIO FERRANDO SEVIL', '105559': 'JUAN CARLOS SERRANO BINABURO', '105535': 'RICARDO PELLEJERO MADURGA', '105485': 'ROBERTO PARACUELLOS RAFALES', '105558': 'CARLOS BENITEZ DAVILA', '106040': 'JESUS ANGEL MATEO GALLEGO', '105529': 'LUIS VICENTE AUSABERRI ARAIZ', '105707': 'DAVID JESUS CATASUS MAINAR', '105537': 'CARLOS JOSE CA√ëADA RODRIGUEZ', '105533': 'VICENTE BAUTISTA PUEYO', '105710': 'ELKIN RAUL ALVAREZ GIRALDO', '105488': 'LUIS ALBERTO DOMINGO MARTINEZ', '105702': 'JOSE LUIS CUARTERO SANCHO', '105468': 'JESUS LOBERA BEGUE', '105538': 'ANGEL LOPEZ LUNA', '105551': 'ANTONIO GONZALEZ LOZANO', '105487': 'JOSE ANTONIO BRAVO VINUES', '105539': 'JOSE ANTONIO FUERTES VILLANUEVA', '105703': 'RAUL ALONSO ALCA√ëIZ', '105663': 'JOSE CRUZ FERNANDEZ', '105846': 'MIGUEL ALLUE BERJAGA', '105851': 'JOSE ANGEL AGUILERA MOLINA', '105747': 'GABRIEL VISOIU RAZVAN', '106473': 'JORGE NARRO JULVEZ', '106489': 'DAVID RUIZ PERIBA√ëEZ', '106493': 'DANIEL GRACIA CHAVARRI', '106608': 'JORGE PINA LUCEA', '106174': 'ALEJANDRO MONGE ESPEJA', '106474': 'ALEJANDRO MOYA CASTEL', '106479': 'JORGE AGUADO BONILLA', '106609': 'SERGIO MOLERO GARCIA', '106610': 'JACINTO IZQUIERDO SOLER', '106611': 'CARLOS CLAVERO CLAVERO', '106612': 'CARLOS FERNANDEZ JIMENEZ', '106682': 'SERGIO MARTINEZ LOSTAL√â', '106683': 'FERNANDO MEN√âNDEZ REINOSO', '106681': 'JAVIER CISNEROS', '105527': 'JESUS TOMAS URIBARRI CLAVERIA', '105536': 'CARLOS LOPEZ LUNA', '105847': 'ANGEL FECED BOLDOVA', '106475': 'JESUS JOVEN MINGUILLON', '106476': 'JUAN CARRASCO ANDRES', '106477': 'DANIEL JUAN JOVEN', '106478': 'ANDRES SARTO SUBIAS', '106480': 'SERGIO CLEMENTE YUS', '106481': 'JOSE ANTONIO LISO CRUZ', '106429': 'JOSE ALEJANDRO BARBECHO MORA', '105528': 'ANTONIO BORREGO TELLO', '105492': 'FERNANDO ALVAREZ HERNANDEZ', '106606': 'ENRIQUE LOPEZ CLAVERIA', '106665': 'MARIUS ION DODU', '106684': 'CYNTHIA LAFUENTE FERNANDEZ', '106685': 'CARLOS MONTA√ëA SAENZ'};

document.addEventListener("DOMContentLoaded", function () {
  flatpickr("#Fechas", {
    mode: "multiple",
    dateFormat: "d/m/Y",
    locale: flatpickr.l10ns.es,
    allowInput: true
  });

  const inputNumero = document.getElementById("NumeroJDE");
  const divNombre = document.getElementById("nombreEmpleado");
  const form = document.getElementById("formFiestas");

  inputNumero.addEventListener("input", function () {
    const num = inputNumero.value.trim();
    if (empleados[num]) {
      divNombre.textContent = empleados[num];
      divNombre.style.color = "black";
    } else {
      divNombre.textContent = "‚ùå N√∫mero no reconocido";
      divNombre.style.color = "red";
    }
  });

  form.addEventListener("submit", async function (e) {
    e.preventDefault();
    const respuesta = document.getElementById("respuesta");
    respuesta.textContent = "";
    respuesta.className = "";

    const fechas = document.getElementById("Fechas").value.split(",").map(f => f.trim()).filter(f => f !== "");

    if (fechas.length === 0) {
      respuesta.textContent = "‚ùå Debes seleccionar al menos una fecha.";
      respuesta.className = "error";
      return;
    }

    if (!empleados[inputNumero.value.trim()]) {
      divNombre.textContent = "‚ùå N√∫mero no reconocido";
      divNombre.style.color = "red";
      return;
    }

    document.getElementById("FechasSolicitadas").value = fechas.join(", ");

    const body = {
      Empleado: inputNumero.value.trim(),
      Email: document.getElementById("Email").value.trim(),
      FechasSolicitadas: fechas.join(", "),
      Comentario: document.getElementById("Comentario").value.trim()
    };

    try {
      const res = await fetch("https://prod-70.westus.logic.azure.com:443/workflows/2035cd8f81154fcc9743ba4b231a1a3f/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Vm-UQaC9QxujqKMk7hAj3phQ_lAOF60hxczY9lzVpqE", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      if (res.ok) {
        respuesta.textContent = "‚úÖ Solicitud enviada correctamente.";
        respuesta.className = "success";
        form.reset();
        divNombre.textContent = "";
      } else {
        respuesta.textContent = "‚ùå Error al enviar la solicitud.";
        respuesta.className = "error";
      }
    } catch (err) {
      console.error("Error de conexi√≥n:", err);
      respuesta.textContent = "‚ö†Ô∏è Error de conexi√≥n.";
      respuesta.className = "error";
    }
  });
});
</script>
</body>
</html>
